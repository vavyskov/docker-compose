version: '3.5'

services:

  visualizer:
    image: dockersamples/visualizer:${VISUALIZER_VERSION:-latest}
    container_name: ${COMPOSE_PROJECT_NAME:-visualizer}_visualizer
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - target: 8080
        published: ${VISUALIZER_PORT:-9003}
    networks:
      - frontend_network
    deploy:
      replicas: 1
      placement:
          constraints:
            - node.role == manager
    labels:
      - traefik.enable=true
      - traefik.http.services.visualizer.loadbalancer.server.port=8080
      #- traefik.http.services.visualizer.loadbalancer.passhostheader=true
      - traefik.http.routers.visualizer.service=visualizer
      - traefik.http.routers.visualizer.rule=Host(`visualizer.example.com`)
      #- traefik.http.routers.visualizer.rule=Host(`visualizer.example.com`) && Path(`/visualizer`)
      #- traefik.http.routers.whoami.rule=Host(`visualizer.example.com`) && PathPrefix(`/visualizer`)
#      - traefik.http.routers.visualizer.tls=true
#      - traefik.http.routers.visualizer.entrypoints=https
      ## BasicAuth (BCrypt or MD5 not SHA1) - https://www.htaccesstools.com/htpasswd-generator/
      - traefik.http.routers.visualizer.middlewares=authvisualizer
      ## In password type $ as $$
      - traefik.http.middlewares.authvisualizer.basicauth.users=visualizer:$$2y$$10$$uLQiFnpnlXso2it40SpzgOkvBsSEu34qMD6X1hvFVHB6qZgbfRRQu

networks:
  frontend_network:
    external: true